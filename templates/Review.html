{% extends 'base.html' %}

{% block title %} Reviews {% endblock %}


{%block head%} 

<link rel="stylesheet" href="/static/css/Cart.css">

{% endblock %}

{% block content%}

<div class="container my-5">
    <h3 class="mb-4">User Reviews</h3>
    {% if session.get('user_id') %}
    <form method="POST">
      {{ form.csrf_token }}
      <div class="form-group">
        {{ form.content.label }}<br>
        {{ form.content(class_="form-control", rows="3") }}
        {% for error in form.content.errors %}
        <div class="text-danger">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-group mt-2">
        {{ form.submit(class_="btn btn-success") }}
      </div>
    </form>
    <hr>
    {% else %}
      <p><a href="{{ url_for('login') }}">Login</a> to post a review.</p>
      <hr>
    {% endif %}

    <!-- List of all reviews -->
    {% for review in reviews %}
    <div class="card mb-3">
        <div class="card-body">
            <p class="card-text">{{ review.content|e }}</p>
            <small class="text-muted">
              by {{ review.user.username }} &middot;
              {{ review.created_at.strftime('%Y-%m-%d %H:%M') }}
            </small>
            {% if session.get('user_id') == review.user_id %}
              <div class="float-right">
                <a class="btn btn-warning btn-sm" href="{{ url_for('edit_review', review_id=review.id) }}">Edit</a>
                <form method="POST" action="{{ url_for('delete_review', review_id=review.id) }}" style="display:inline;" onsubmit="return confirm('Delete this review?');">
                  <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
              </div>
            {% endif %}
        </div>
    </div>
    {% else %}
      <p>No reviews yetâ€”be the first to leave one!</p>
    {% endfor %}
</div>

{%endblock%}